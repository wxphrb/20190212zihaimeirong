<!-- 模板继承 -->
{extend name="template/create" /}
{block name="content"}
<div class="panel panel-default">
        <div class="panel-heading">
          <div class="panel-btns">
            <a href="" class="panel-close">&times;</a>
            <a href="" class="minimize">&minus;</a>
          </div>
          <h4 class="panel-title">{:$mate_operate}-{:$mate_title}</h4>
        </div>
        <div class="panel-body panel-body-nopadding">
        <form class="form-horizontal form-bordered" id="submitForm" action="" method="post" >

		<div class="form-group">
            <label class="col-sm-3 control-label">封面图：</label>
            <div class="col-sm-6">
                <input id="fileone" type="file" class="file-loading">
                <input type="hidden" id="picurl" placeholder="图片" name="picurl" value="{$old_car_data.picurl ?? ''}" >
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">组图：</label>
            <div class="col-sm-6">
                <input id="filepic" type="file" multiple>
                {present name="old_car_data.picarr"}
                    {volist name="old_car_data.picarr" id="vop"}
                        <input type="hidden" value="{$vop.img}" name="picimg[]" >
                    {/volist}
                {/present}
            </div>
        </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span>*</span>商家售价(/元)：</label>
                <div class="col-sm-6">
                    <input type="text" class="form-control" placeholder="商家售价" name="car_price" value="{$vo.car_price ?? ''}"  required>
                </div>
            </div>
            <div class="form-group">
                <div style="text-align: center;">车辆参数：<button class="basic" va="1" style="font-size: 18px;">展开↓↓</button></div>
            </div>
            <div id="basic_list1" style="height: 200px;overflow: hidden;">
            {volist name="basic_parma" id="parma_vo"}

            <div class="form-group">
                <label class="col-sm-3 control-label">{$parma_vo.name}：</label>
                <div class="col-sm-6">
                        <input type="text" class="form-control" name="{$parma_vo.value}[]" value="{$old_car_data[$parma_vo.value] ?? ''}" readonly>

                </div>
            </div>

            {/volist}
            </div>
            <div class="form-group">
                <div style="text-align: center;">详细参数：<button class="basic" va="2" style="font-size: 18px;">展开↓↓</button></div>
            </div>
            <div id="basic_list2" style="height: 200px;overflow: hidden;">
             {volist name="car_parma" id="ctype1"}
                <div style="text-align: center; font-size: 20px; margin-bottom: 20px;">{$ctype1.title}</div>
                {volist name="$ctype1.data" id="ctype"}
                <div class="form-group">
                    <label class="col-sm-3 control-label">{$ctype.name}</label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" placeholder="{$ctype.name}" name="{$ctype.value}" value="{$new_car_data[$ctype.value] ?? '-'}" >
                        </div>
                </div>
                {/volist}
            {/volist}
            </div>


         <div class="panel-footer">
         <div class="row">
          <div class="col-sm-6 col-sm-offset-3">
            <input type="hidden" name="id" value="{$vo.id ?? ''}">
              <!--<button type="submit" class="btn btn-primary">提交</button>-->
              <button type="button" class="btn btn-default" onclick="javascript:history.back(-1);">返回</button>
            </div>
           </div>
          </div>

        <!-- panel-footer -->

    </form>

</div><!-- panel-body -->
{/block}
{block name="fileinput"}{__block__}{/block}
{block name="ueditor"}{/block}
{block name="script"}
<script>
    $('.basic').toggle(
        function(){
             va = $(this).attr('va')
             $('#basic_list'+va).css('height','100%');
             $(this).text('收起↑↑')
        },
        function(){
            va = $(this).attr('va')
            $('#basic_list'+va).css('height','200px');
            $(this).text('展开↓↓')
        }
    )
    $('#p_pinpai_id').change(function(){
        p_pinpai_id = $(this).val();
        $.ajax({
            type:"post",
            url:"{:url('OldCar/getcarlist')}",
            data:{ 'p_pinpai_id': p_pinpai_id},
            dataType: "json",
            success:  function(data){
                if(data.code == 400){
                    tips('网络错误请重新选择');
                }else{
                   if(data.data==''){
                       tips('该品牌没有相关车型');
                   }else{
                        $('#p_chexi_id').html('');
                        arr = data.data;
                        str = '';
                        for ( var i = 0; i <arr.length; i++){
                            if(i == 0){
                                $('#select2-chosen-2').text(arr[i]['p_chexi']);
                                str += '<option value="'+arr[i]['p_chexi_id']+'" selected>'+arr[i]['p_chexi']+'</option>'
                            }else {
                                str += '<option value="' + arr[i]['p_chexi_id'] + '">' + arr[i]['p_chexi'] + '</option>'
                            }
                        }
                        $('#p_chexi_id').append(str);
                   }

                }

            }
        });
    })
    $('#p_chexi_id').change(function(){
        p_chexi_id = $(this).val();
        $.ajax({
            type:"post",
            url:"{:url('OldCar/getchexilist')}",
            data:{ 'p_chexi_id': p_chexi_id},
            dataType: "json",
            success:  function(data){
                if(data.code == 400){
                    tips('网络错误请重新选择');
                }else{
                    if(data.data==''){
                        tips('该品牌没有相关车型');
                    }else{
                        $('#new_car_id').html('');
                        arr = data.data;
                        str = '';
                        for ( var i = 0; i <arr.length; i++){
                            if(i == 0) {
                                $('#select2-chosen-3').text(arr[i]['p_chexingmingcheng']);
                                str += '<option value="' + arr[i]['id'] + '" selected>' + arr[i]['p_chexingmingcheng'] + '</option>'
                            }else {
                                str += '<option value="' + arr[i]['id'] + '">' + arr[i]['p_chexingmingcheng'] + '</option>'
                            }
                        }
                        $('#new_car_id').append(str);
                    }
                }

            }
        });
    })
$(document).ready(function() {
    fileinputOne("fileone","picurl");
    fileinputMore('filepic','picimg[]','picarr[]');
    $("[name='parentid']").find("[value='{$vo.parentid ?? '0'}']").attr("selected", true);

    $('#submitForm').bootstrapValidator({
        message: '这个值是无效的',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        }
    });
    //select2
    jQuery(".select2").select2({
        width: '100%',
        minimumResultsForSearch: -1
    });
});
function addattrs(){
    var title = $('#attrs_title').val();

    var list=new Array();
    $("input[name='attrs_group[]']").each(function(){
            list.push($(this).attr('name'));
    });
    //console.log(list);
    var num = list.length;

    if(title!=''){
        $('#trhead').before('<th>'+title+'</th>');
        $('.tdbody').before('<td></td>');

        var html = '<div class="form-group" id="attrs'+num+'_group"  style="border: 0;">'
                 +'   <label class="col-sm-3 control-label">'+title+'：<input type="hidden" name="attrs_group[]" value="'+title+'"></label>'
                 +'   <div class="col-sm-6">'
                 +'      <div class="input-group">'
                 +'         <span class="input-group-btn">'
                 +'           <button type="button" class="btn btn-default" onclick="addinput('+num+')">添加</button>'
                 +'         </span>'
                 +'         <input type="text" class="form-control" id="attrs'+num+'_add" value=""/>'
                 +'       </div>'
                 +'       <span id="attrs'+num+'_area">'
                 +'       </span>'
                 +'    </div>'
                 +' </div>';

        $('#attr_area').append(html);
        $('#attrs_title').val('');
    }

}

function addinput(param){
    var val = $('#attrs'+param+'_add').val();
    if(val!=''){
        $('#attrs'+param+'_area').append('<input type="checkbox" name="attrs'+param+'[]" value="'+val+'" checked>'+val);
        $('#attrs'+param+'_add').val('');
    }
}

function chooseAttr(val){
     $.ajax({
             url: "{:url('console/goods/getattr')}",    //提交的页面，方法名
             dataType: "json",     //类型
             data:{"typeid":val},
             type: "POST",     //提交方式
             success: function (data) { //如果执行成功，那么执行此方法
             //alert(JSON.stringify(data));
                $('#attrs').empty();
                $('#attr_area').empty();
                $('#theadtr').empty();
                var dataObj=eval("("+data+")");//转换为json对象
                $.each( dataObj, function(index,item){

                   var html = '<div class="form-group" id="attrs'+index+'_group"  style="border: 0;">'
                             +'   <label class="col-sm-3 control-label">'+item['title']+'：<input type="hidden" name="attrs_group[]" value="'+item['title']+'"></label>'
                             +'   <div class="col-sm-6">'
                             +'      <div class="input-group">'
                             +'         <span class="input-group-btn">'
                             +'           <button type="button" class="btn btn-default" onclick="addinput('+index+')">添加</button>'
                             +'         </span>'
                             +'         <input type="text" class="form-control" id="attrs'+index+'_add" value=""/>'
                             +'       </div>'
                             +'       <span id="attrs'+index+'_area">';
                             $.each( item['attrs'], function(index1,item){
                                html +='<input type="checkbox" name="attrs'+index+'[]" value="'+item+'" checked>'+item;

                             });
                        html +='       </span>'
                             +'    </div>'
                             +' </div>';

                    $('#attr_area').append(html);

                    $('#theadtr').append('<th>'+item['title']+'</th>');

                });
                $('#theadtr').append('<th id="trhead">价格</th>');
                $('#theadtr').append('<th>库存</th>');
           },
           error: function (err) { //如果执行不成功，那么执行此方法
            tips('ajax出错了1');
           }
       });
}
</script>
{/block}
