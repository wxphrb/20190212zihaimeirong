<?phpnamespace app\console\controller;use app\console\model\Webtype as WebtypeModel;use app\console\model\Webconfig as WebconfigModel;use think\Cache;use think\Request;use think\Url;class System extends Base{    /**     * [index    配置管理]     * console/system/index     *     * @param WebtypeModel $webtype     * @return mixed     */    public function index(WebtypeModel $webtype)    {        $webtype_list = $webtype            ->relation(['webconfig'])            ->select();       /* $a = json_encode($webtype_list);        $b = json_decode($a,true);        wcc($b);*/        return $this->fetch('index', [            'mate_title' => "配置管理",            'list' => $webtype_list,        ]);    }    /**     * [whole    全局管理设置]     * console/system/whole     *    `     * @param Request $request     * @param WebconfigModel $webconfig     */    public function whole(Request $request, WebconfigModel $webconfig)    {        if ($request->isPost()) {            Cache::set('webconfig', $request->post());            $web = Cache::get('webconfig');            foreach ($web as $k => $v) {				if(strstr($v,"tempdir")){					$path    = ROOT_PATH . 'public' . DS . $v;                    $file    = \think\Image::open($path);					$newpath = str_replace("tempdir","uploads",$v);					$file->save(ROOT_PATH . 'public'. DS .$newpath);					@unlink(ROOT_PATH . 'public'. DS .$v);					$v       = $newpath;				}                $webconfig->where('varname', $k)->setField('varvalue', $v);            }            /*添加修改web.inc.php*/            $value = db('webconfig')->field('varname,varvalue')->select();            $arr = [];            foreach($value as $v){                $arr[$v['varname']] = $v['varvalue'];            }            // 文件路径            $path = APP_PATH . "common" . DS . "common" . DS . "web.inc.php";            file_put_contents($path, serialize($arr));            /*修改end*/            $this->success('操作成功!', Url::build("console/system/index"));        } else {            $this->error('操作失败!');        }    }}