{extend name="template/index" /}
{block name="content"}
<div class="panel panel-default">
    <div class="panel-heading" style="border-bottom:none;">

        <div>
            <a class="btn btn-primary" href="{:url('console/OldCar/create',['type'=>1])}" style="float:right;">手动添加</a>
        </div>
        <div style="margin-left: -10px;float: right; margin-right: 30px;">
            <form action="{:url('console/OldCar/vincode')}" method="post" id="vinform" enctype="multipart/form-data" onsubmit="return checkform();">
                <div class="col-lg-3" style="width:auto;">

                    <input type="text" name="vin" value="{$vin ?? ''}" id="vin"  class="form-control" placeholder="车辆vin码">
                </div>
                <input type="submit" class="btn btn-primary" value="vin码添加">

            </form>
        </div>
        <h4 class="panel-title">{:$mate_operate}</h4>
    </div>
    <div class="panel-body">

        <div class="table-responsive">
            <div style="margin-left: -10px;">

                <form action="" method="post" enctype="multipart/form-data">
                    <div class="col-lg-3">

                        <input type="text" name="name" value="{$name ?? ''}" class="form-control" placeholder="品牌/车系/车辆名称">

                    </div>
                    <input type="submit" class="btn btn-primary" value="搜索">
                    <input type="button" id="empty_search" class="btn btn-primary" value="清空查询条件">

                </form>

            </div>

            <br>
            <table class="table table-striped table-bordered table-hover" id="table1">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>品牌</th>
                    <th>车系</th>
                    <th style="width:30%;">车辆名称</th>
                    <th>所属车行</th>
                    <th>提交时间</th>
                    <th>是否推荐</th>
					<th>售出状态</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {volist name="list" id="vo"}
                <tr>
                    <td>
                        <div class="ckbox ckbox-primary">
							<input type="checkbox" id="checkbox{$vo.id}" name="checkid[]" value="{$vo.id}"/>
                            <label for="checkbox{$vo.id}">{$vo.id}</label>
						</div>
                    </td>
                    <td>{$vo.brandName}</td>
                    <td>{$vo.groupName}</td>
                    <td>{$vo.vehicleName}</td>
                    <td>{$vo.ch_id}</td>
                    <td>{$vo.createtime}</td>
                    <td>{$vo.recommend|show_recommend=$vo.id}</td>
                    <td>
						<!--{$vo.status_buy|show_buy_status=$vo.id,$vo.status_buy}-->
						<div class="btn-group fm-group">
						<button type="button" class="btn btn-default dropdown-toggle fm-toggle" data-toggle="dropdown">                    
							{switch name="$vo.status_buy"}
								{case value="0"}-{/case}
								{case value="1"}已订车{/case}
								{case value="2"}贷款中{/case}
								{case value="3"}已售出{/case}
								{default /}
							{/switch}
							</button>
							<ul class="dropdown-menu fm-menu" role="menu">
							<li><a href="{:url('console/old_car/renewfieldtwo', ['id' => $vo['id'],'status_buy'=>0,'page'=>$pagenum])}"><i class="fa fa-pencil"></i> - </a></li>
							<li><a href="{:url('console/old_car/renewfieldtwo', ['id' => $vo['id'],'status_buy'=>1,'page'=>$pagenum])}"><i class="fa fa-pencil"></i>已订车</a></li>
							<li><a href="{:url('console/old_car/renewfieldtwo', ['id' => $vo['id'],'status_buy'=>2,'page'=>$pagenum])}"><i class="fa fa-pencil"></i>贷款中</a></li>
							<li><a href="{:url('console/old_car/renewfieldtwo', ['id' => $vo['id'],'status_buy'=>3,'page'=>$pagenum])}"><i class="fa fa-pencil"></i>已售出</a></li>
							</ul>
						</div>
					</td>
					<td>{$vo.status|show_status=$vo.id}</td>
                    <td>
                        {if condition="$vo.new_car_id eq ''"}
                            {$vo.id|show_operate='update','补全信息'}
                        {else/}
                            {$vo.id|show_operate='update','编 辑'}
                        {/if}
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        {$vo.id|show_operate='showinfo','查看详细参数'}
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        {$vo.id|show_operate='delete','删 除'}
                    </td>
                </tr>
                {/volist}
                </tbody>
            </table>
            <!-- start-deleteArea -->
            <div class="form-inline">
                <label class="control-label">操作:</label>&nbsp;&nbsp;
                <div class="checkbox ckbox ckbox-danger"><input type="checkbox" id="checkboxAll"
                                                                onclick="check_all(this);"/>
                    <label for="checkboxAll"></label>
                </div>
                {:show_operate('0','delete','删 除')} <!-- 全选删除   -->
            </div>
            <!-- end-deleteArea -->
        </div><!-- table-responsive -->
    </div>
    <div style="margin-left: -5px;">

        {$list->render()}

    </div>
</div>
</div><!-- rightpanel -->

{/block}
{block name="script"}
    <script>
        $('#empty_search').click(function(){
            window.location.href="{:url('OldCar/index')}";
        })

        function checkform(){

            vin = $('#vin').val();

            if(vin == ''){
                tips('请输入vin码');

                return false;
            }else{

                if(onblurjs(vin)){

                    return true;
                }else{
                    tips('vin码输入有误');
                    return false;
                }

            }
            return false;
        }
        //车架号验证 vin
        var onblurjs = function(vin){

            if(vin.length>0 && vin.length!=17){
                return false;
            }else{
                var vinVal = vin.toUpperCase();
                //document.getElementById("vin_"+k).value = vinVal;
                var charToNum = {'A':1,'B':2,'C':3,'D':4,'E':5,'F':6,'G':7,'H':8,'J':1,'K':2,'L':3,'M':4,'N':5,'P':7,'R':9,'S':2,'T':3,'U':4,'V':5,'W':6,'X':7,'Y':8,'Z':9};
                var obj = 0;
                var arr = new Array();
                for (var i = 0 ; i < vinVal.length; i++) {
                    var temp = vinVal.charAt(i);

                    if(charToNum[temp]){
                        arr[i] = charToNum[temp];
                    }else{
                        arr[i] = Number(temp);
                    }
                    if(i==8){
                        arr[i] = vinVal.charAt(i);
                    }

                };
                var a1 = 8;
                for (var i = 0; i < 7; i++) {
                    obj += Number(arr[i]) * a1 ;
                    a1--;
                };

                obj += Number(arr[7])*10;

                var a2 = 9;
                for (var i = 9; i < 17; i++) {
                    obj += Number(arr[i]) * a2;
                    a2--;
                };

                var result = Number(obj)%11;
                if(parseInt(result) === 10){
                    result = 'X';
                }
                if(result == arr[8]){
                    //成功
                    return true;
                }else{
                    //失败
                    return false;
                }
            }
        };

    </script>
{/block}
