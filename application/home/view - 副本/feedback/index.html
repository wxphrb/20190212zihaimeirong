<!--顶部导航-->{include file="public/header" /}<link rel="stylesheet" type="text/css" href="__HOME__/shangchuan/css/newbase.css"><!--顶部导航--><style>    .z_photo{        overflow: inherit;        padding: 0;    }    .details_btn{        position: inherit;        background: none;    }    .details_btn a{        margin-top: 0.6rem;    }    #ul_pics li {width: 70px!important;position: relative}</style></head><script>    $(function () {        var h=$(".photo li").width();        $(".fileInputContainer").css({height:h+"px"});        $(".fileInput").css({height:h+"px"});    })</script><body><div class="wrap">    <header>        <img src="__HOME__/img/back_btn_03.png" class="back_btn" onclick="user_index()">        <p class="title">意见反馈</p>    </header>    <script>        function user_index(){            window.location.href="{:url('home/user/index')}";        }    </script>    <div class="yjfk_content">        <form  name="form" id="form" method="post" enctype="multipart/form-data">            <div class="ul_div">                <ul>                    <li class="ul_div_li_style" zhi="1">                        软件问题                    </li>                    <li zhi="2">商品问题</li>                    <li zhi="3">其他问题</li>                </ul>                <input type="hidden" name="type" id="type">                <p class="text_p">描述你的问题</p>                <textarea class="text1" name="content" id="content"></textarea>                <p class="sc_p">上传凭证（选填，最多不超过3张）</p>                <ul class="photo">                    <li id="btn" style="height: 70px;width: 70px;margin-bottom: 5px;"><img style="height: 70px;width: 70px;" src="__HOME__/shangchuan/img/pl-tupian.png">                    </li>                    <ul id="ul_pics"></ul>                    <div id="img2"><input name='picArr' id="picArr[]" type='hidden' value=''></div>                    <div class="cl"></div>                </ul>            </div>            <div class="ul_div_d1" style="margin-top: 0.4rem">                <p>联系人</p>                <input type="text" name="username" id="username" placeholder="输入您的姓名">            </div>            <div class="ul_div_d1">                <p>联系方式</p>                <input type="text" id="mobile" name="mobile" placeholder="输入手机号码">            </div>            <div class="details_btn" onclick="add_feed()"><a>提交</a></div>        </form>    </div></div></body></html><script>    $(".ul_div ul li").click(function(){        var tr= $(this).attr("zhi");        console.log(tr);        $(".ul_div ul li").removeClass("ul_div_li_style");        $(this).addClass("ul_div_li_style");        $("#type").val(tr);    });</script><script type="text/javascript" src="__HOME__/shangchuan/js/plupload.full.min.js"></script><script type="text/javascript">    $(function () {        $('.star_score').children('a:last-child').addClass('clibg');        $('.fenshu').text(5);    })    $(window).resize(function(){        $('.footer').toggle();    });    var uploader = new plupload.Uploader({        runtimes: 'html5,flash,silverlight,html4',        browse_button: 'btn',        url: "{:url('home/upload/ossUpload')}",//        filters: {//            max_file_size: '2048kb',//            mime_types: [//                {title: "files", extensions: "jpg,png,gif,jpeg,PNG,JPG,JPEG,GIF"}//            ]//        },        multi_selection: true,        init: {            FilesAdded: function (up, files) {                if ($("#ul_pics").children("li").length > 3) {                    layer.msg("您上传的图片太多了！");                    uploader.destroy();                } else {                    var li = '';                    plupload.each(files, function (file) {                        li += "<li id='1" + file['id'] + "'><div class='progress'><span class='bar'></span><span class='percent'>0%</span></div></li>";                    });                    $("#ul_pics").append(li);                    uploader.start();                }            },            UploadProgress: function (up, file) {                var percent = file.percent;                $("#1" + file.id).find('.bar').css({"width": percent + "%"});                $("#1" + file.id).find(".percent").text(percent + "%");            },            FileUploaded: function (up, file, info) {                if ($("#ul_pics").children("li").length > 3) {                    layer.open({content:"最多只能上传3张图片！",skin:'msg',time:2});                    $("#1" + file.id).remove('');                    return false;                    uploader.destroy();                }                document.getElementById('img2').innerHTML = '';//                        var data = JSON.parse(info.response);                var data = eval("(" + info.response + ")");                $("#1" + file.id).html("<img style='height: 70px;width: 70px;float: left;' src=" + data.picUrl +                        "><input  name='picArr' id='picArr[]' type='hidden' value='" + data.picUrl +                        "'><a style='position:absolute;top: -6px;right: -6px;display: block;width: 16px;height: 16px;background: #fff;border-radius: 16px;box-shadow: 0 0 2px #000;' onclick=img_del('1" + file.id + "','" + data.picUrl + "','{:url(\'upload/uploadImgDestroy\')}')><img style='height: 10px; width: 10px;float: left;margin: 3px;' src='__HOME__/shangchuan/img/icon21.png'/></a>");            },            Error: function (up, err) {                layer.msg('服务器异常,请重新上传');            }        }    });    uploader.init();    // 取消上传图片    function img_del(id, picUrl, url) {        $.ajax({            url: url,            type: 'post',            dataType: 'json',            data: {picUrl: picUrl},            async: true,            success: function (data) {                if (data.code == '200') {                    $("#" + id).remove('');                    layer.open({content:data.message,skin:'msg',time:2});                } else {                    layer.open({content:data.message,skin:'msg',time:2});                    return false;                }            },            error: function () {                layer.open({content:'网络繁忙,请重试',skin:'msg',time:2});            }        });    }</script><script>    function add_feed() {        var tr= $("#type").val();        if(tr == "") {            tr = 1;        }        var username = $('#username').val();        var mobile = $('#mobile').val();        var content = document.getElementById('content').value;//        if(content.length > 5){//            layer.msg('内容不少于5个字');//            return false;//        }        if(username == "" || username.length == 0) {            layer.msg("姓名不能为空");            return false;        }        if (mobile == "") {            layer.msg('手机号不能为空');            return false;        }        if(content == "" || content.trim().length == 0){            layer.msg("描述不能为空");            return false;        }        shous = /^1[23456789]\d{9}$/;        if (shous.test(mobile) === false) {            layer.msg('手机号格式错误');            return false;        }//        alert(content);return false;        var pic = document.getElementsByName("picArr");        var picArr = '';        if (pic) {            $("input[name='picArr']").each(function () {                picArr += $(this).val()+'|';            });            picArr = picArr.substr(0,picArr.length-1);        } else {            picArr = '';        }        $.ajax({            url: "{:url('home/Feedback/add_feed')}",            type: 'post',            dataType: 'json',            data:{                type:tr,                username:username,                mobile:mobile,                content:content,                picArr:picArr,            },            success: function (data) {//                console.log(data);return false;                if(data == 1){                    layer.msg('反馈成功!', {                        time: 2000 //2秒关闭（如果不配置，默认是3秒）                    }, function(){                        window.location.href="{:url('home/user/index')}";                    });                    return false;                }else{                    layer.msg("反馈失败");                    return false;                }            }        });    }</script>