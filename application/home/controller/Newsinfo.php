<?phpnamespace app\home\controller;use app\api\model\Address;use app\api\model\Job;use app\api\model\Posts;use app\home\model\BbcAnswer;use app\home\model\BbcQuestion;use app\home\model\Certification;use app\home\model\Collection;use app\home\model\Orders;use app\home\model\Supply;use app\home\model\User;use app\home\model\Faq;use app\home\model\Store;use mrmiao\encryption\RSACrypt;use think\Controller;use think\Db;use think\Request;use think\Url;use think\Session;class Newsinfo extends Base{    public function index()    {        $param  = Request::instance()->param();//        halt($param);//        dump($param);        if($param['type'] == 1) {//最新公告            $data = Db::name('news_info')                ->where(['status'=>1,'user_id'=>Session::get('user_id')])                ->order("create_time", "desc")                ->field("id,type,title,other_id,read_state,create_time")                ->order('id desc')                ->select();            return $this->fetch('index', [                'title' => "消息",                'list'=>$data,                'status'=>$param['status'],                'notice_num' => Db::name('news_info')->where(['user_id'=>Session::get('user_id'),'status'=>1,'read_state'=>0])->count(),                'news_num' => Db::name('news_info')->where(['user_id'=>Session::get('user_id'),'status'=>2,'read_state'=>0])->count(),            ]);        } else { //推送消息            $data = Db::name('news_info')                ->where( ['status'=>2,'user_id'=>Session::get('user_id')])                ->order("create_time", "desc")                ->field("id,type,title,other_id,read_state,create_time")                ->order('id desc')                ->select();            return $this->fetch('index2', [                'title' => "消息",                'list'=>$data,                'status'=>$param['status'],                'notice_num' => Db::name('news_info')->where(['user_id'=>Session::get('user_id'),'status'=>1,'read_state'=>0])->count(),                'news_num' => Db::name('news_info')->where(['user_id'=>Session::get('user_id'),'status'=>2,'read_state'=>0])->count(),            ]);        }    }    /*         * 变为已读         * */    public function read(RSACrypt $crypt, NewsInfoModel $newsInfo){        $request = $crypt->request();        $data = $newsInfo->where('id','in',$request['id'])->update(['read_state'=>1]);        if($data){            return $crypt->response(['code' => 200, 'message' => '成功']);        }    }    /*     * 删除     * */    public function del(RSACrypt $crypt, NewsInfoModel $newsInfo){        $request = $crypt->request();        $data = $newsInfo->where('id','in',$request['id'])-> delete();        if($data){            return $crypt->response(['code' => 200, 'message' => '成功', 'data' => $data]);        }    }    /*     * 新闻详情页     * */    public function news_web(Request $request){        $post_data = $request->param();        Db::name('news_info')->where("id", $post_data['id'])->update(['read_state'=>1]);        $content = Db::name('news_info')->where("id", $post_data['id'])->value("content");        return $this->fetch('news_web',['title'=>"详情",'content'=>$content]);    }}