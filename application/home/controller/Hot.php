<?phpnamespace app\home\controller;use app\home\model\BbcQuestion;use app\home\model\BbcAnswer;use app\home\model\IndustryInformation as IndustryInformationModel;use app\home\model\Posts as PostsModel;use think\Controller;use think\Db;use think\Request;use think\Url;class Hot extends Controller{    /*     * 帖子     * */          public function index(Request $requests,PostsModel $posts){              $request  =$requests->param();              $where['status']=1;              $where['hot_state']=1;              //列表              $data['list'] = $posts->where($where)->field('id,title,picarr,picarr_type,praise,comments_num,hot_state,share_num')->order('id desc')->select();              return $this->fetch(                  'index',[                      'title'=>"万淘热点",                      'data'=>$data                  ]              );          }          /* * 咨询 * */          public function industry(Request $requests ,Goods $goods ,IndustryInformationModel $industryInformation,                                   User $user){                    $request  =$requests->param();                    $where['status']=1;                    $where['hot_state']=1;                    $data = $industryInformation->where($where)->field('id,title,user_id,picarr,picarr_type,description,hot_state,create_time,content')->order('id desc')->select();                    foreach($data as &$v){                        $level_id = Db::name('user')->where('id',$v['user_id'])->value('level_id');                        $level_title = Db::name('certification_type')->where('id',$level_id)->value('title');                        $v['level_id'] = $level_id;                        $v['level_title'] = $level_title;                              if($v['user_id']!=0){                                        $v['username'] = $user->where('id',$v['user_id'])->value('username');                                        $v['picurl'] = $user->where('id',$v['user_id'])->value('picurl');                              }else{                                        $v['username']='官方发布';                                        $v['picurl']='__HOME__/img/about_img_03.png';                              }                    }                    return $this->fetch(                              'industry',[                                        'title'=>"万淘热点",                                        'data'=>$data                              ]                    );          }          /* * 问答 * */          public function bbc(Request $requests ,BbcQuestion $bbcQuestion,BbcAnswer $answer){                    $request = $requests->param();                    //问答列表 筛选条件 分类id 关键词                    $where['status']=1;                    $where['hot_state']=1;                    if(!empty($request['keyword'])){                              $where['title']=['like','%'.$request['keyword'].'%'];                              $this->lishi($request['keyword']);                    }                    //列表                    $data['list'] = $bbcQuestion->where($where)->field('id,title,answer_num,integral_num,hot_state,create_time')->order('id desc')->select();                    //回答                    foreach($data['list'] as $v){                              $best_answer = $answer->where(['question_id'=>$v['id'],'status'=>1])->value('content');//问题最佳答案                              if(empty($best_answer)){//如果没有，就取最新的答案                                        $mew_answer = $answer->where(['question_id'=>$v['id']])->order('id desc')->value('content');                                        $v['answer'] = empty($mew_answer)?'':$mew_answer;                              }else{                                        $v['answer']=$best_answer;                              }                    }                    return $this->fetch(                              'bbc',[                                        'title'=>"万淘热点",                                        'data'=>$data                              ]                    );          }}