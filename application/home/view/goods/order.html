<!--顶部导航-->{include file="public/header" /}<style>    .name{        display: block;        text-align: left;        margin-left: 20px;        padding: 0.15rem 0;    }    .address1{        display: block;        text-align: left;        margin-left: 20px;        padding: 0.15rem 0;    }</style><body class="bgfafafa"><div id="page">    {if condition="$address['id'] eq ''"}        <div class="tian_dizhi">            <a href="{:url('address/add_address')}"><span>添加收货地址</span></a>        </div>    {else/}    <div style="font-size: 0.28rem;">      <p class="name">          <span>收货人：</span>          <span>{$address['username']}  {$address['mobile']}</span>      </p>      <p class="address1">          <span>收货地址：</span>          <span>{$address['prov']}{$address['city']}{$address['area']}{$address['address']}</span>      </p>    </div>    {/if}    <div class="xian"></div>    <!--一组-->    <div class="ding_ding">        <div class="ding_hao">{$time}</div>        <div class="ding_list">            <a href="{:url('goods/info')}?id={$data.id}" style="width: 100%;  display: -webkit-box;">                <div class="ding_list_tu"><img src="__ROOT__{$data.picurl}"></div>                <div class="ding_list_zi">                    <div class="ding_list_ti">{$data.title}</div>                    <div class="ding_list_gg">规格：{$data.attr}</div>                    <div class="ding_list_jg"><font>￥</font>{$data.price}</div>                </div>                <div class="ding_list_shu">X&nbsp;{$data.num}</div>            </a>        </div>        <div class="ding_he tj_he">合计：&nbsp;&nbsp;<font>￥{$data.total}</font></div>    </div>    <!--一组-->    <div class="tding_xx">        <div class="tding_zi">配送方式</div>        <div class="tding_xuan">            <a href="javascript:void(0);" id="ddzt" class="tding_xuan_z">到店自提</a>            <a href="javascript:void(0);" id="kddf">快递到付</a></div>    </div>    <div id="ddzt_div">        <div class="tding_xx">            <div class="tding_sr">                <input id="zt_user" type="text" placeholder="请输入联系人">            </div>            <div class="tding_x"></div>            <div class="tding_sr">                <input id="zt_mobile" type="text" placeholder="请输入联系电话">            </div>        </div>        <div class="men_xx">            <div class="men_ti">门店信息</div>        </div>        <div class="men_xx" style="margin-top: 20px;">            <ul>                {notempty name="store"}                {volist name="store" id="st"}                    <li class="men_zi" aid="{$st.id}">                        <p>{$st.title}</p>                        <p>{$st.mobile}</p>                        <p>{$st.address}</p>                    </li>                {/volist}                {else/}                    <li style="font-size: 0.25rem;">                        请添加地址信息，后选择附近门店                    </li>                {/notempty}            </ul>            <div class="clear"></div>        </div>        <script>            $(".men_zi").click(function(){                id = $(this).attr('aid');                $('#store_id').val(id);                var suo = $(".men_zi").index(this);                $(".men_zi").eq(suo).attr("id","mo_men");                $(".men_zi").eq(suo).siblings().attr("id","");            })        </script>    </div>    <div class="pb100"></div>    <div class="pb100"></div>    <div class="dt_foot">        <div class="dt_fzi">总计：<font>￥</font><span>{$data.total}</span></div>        <div class="go_fsuan"><input type="button" value="结算" onclick="tj()"></div>    </div>    <input id="pay_type" type="hidden" value="ddzt">    <input id="store_id" type="hidden" value="0"></div></body></html><script>    var chickable=0;//防止表单重复提交    function tj(){        var pay_type =$("#pay_type").val();        var address_id = "{$address['id']}";        var zt_user    = '';        var zt_mobile  = '';        var store_id   = 0;        if(pay_type == 'ddzt'){            zt_user   = $('#zt_user').val();            zt_mobile = $('#zt_mobile').val();            store_id  = $('#store_id').val();            if(zt_user == ''){                layer.msg('请输入自提联系人姓名');                return false;            }            if(zt_mobile == ''){                layer.msg('请输入自提联系人手机号');                return false;            }            if(store_id == 0 || isNaN(store_id)){                layer.msg('请选择自提门店');                return false;            }            shous = /^1[3456789]\d{9}$/;            if (shous.test(zt_mobile) === false) {                layer.msg('自提联系人手机号输入有误');                return false;            }        }        var attr="{$data['attr']}";        var num="{$data['num']}";        var carriage = "{$data['carriage']}";        var goods_price = "{$data['goods_price']}";        var goods_id= "{$data['id']}";        if(chickable==0){            chickable=1;        $.ajax({            url: "{:url('goods/place_order')}",            type: 'post',            dataType: 'json',            data:{type:pay_type,address_id:address_id,mobile:zt_mobile,username:zt_user,attr:attr,num:num,carriage:carriage,goods_price:goods_price,goods_id:goods_id,store_id:store_id},            success: function (data) {                    if (data.code == 200) {                       // if (data.par_type == 1) {                            setTimeout(function () {                                window.location.href = "{:url('home/wei_pay/index')}?order_sn=" + data.order_sn+"&attach=2";                                //console.log(data.data);                            }, 2000);                        //}                        /*                        if (data.par_type == 2) {                            setTimeout(function () {                                window.location.href = "{:url('home/Alipay/pay')}?order_sn=" + data.order_sn + "&type=2";                            }, 2000);                        }                        if (data.par_type == 3) {                            setTimeout(function () {                                var ordersnum = data.data;                                window.location.href = "{:url('home/wei_pay/index')}?order_sn=" + data.order_sn;                            }, 2000);                        }                        *///                    layer.msg('提交成功!', {//                        time: 2000 //2秒关闭（如果不配置，默认是3秒）//                    }, function(){//                        if(pay_type == 1) {//                            window.location.href="{:url('home/wei_pay/index')}?order_sn="+data.order_sn;//                        }//                    });                    } else {                        layer.msg(data.message);                    }            }        })        }else{            layer.msg('网络错误，请刷新后重试');        }     }     $('#ddzt').click(function(){         $('#ddzt_div').show();         $('#kddf').removeClass('tding_xuan_z');         $('#pay_type').val('ddzt');         $(this).attr('class','tding_xuan_z')     })     $('#kddf').click(function(){         $('#ddzt_div').hide();         $('#ddzt').removeClass('tding_xuan_z');         $('#pay_type').val('kddf');         $(this).attr('class','tding_xuan_z')     })</script>